## 目录
```
### 第13章 分组数据........................83
#### 13.1 数据分组 .............................83
#### 13.2 创建分组 .............................83
#### 13.3 过滤分组 .............................85
#### 13.4 分组和排序 .........................87
#### 13.5 SELECT子句顺序.................88
#### 13.6 小结.....................................89
```


## 第13章 分组数据........................83
* 介绍如何分组数据，以便能汇总表内容的子集。这涉及两个新 SELECT 语句子句，分别是 GROUP BY 子句和 HAVING 子句

* 分组允许把数据分为多个逻辑组，以便能对每个组进行聚集计算

### 13.1 数据分组 .............................83

### 13.2 创建分组 .............................83
* 分组是在 `SELECT` 语句的 `GROUP BY` 子句中建立的

* 使用 `GROUP BY` 子句需要知道的一些重要规定:
    * `GROUP BY` 子句可以包含任意数目的列。这使得能对分组进行嵌套，为数据分组提供更细致的控制;

    * 如果在 `GROUP BY` 子句中嵌套了分组，数据将在最后规定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算（所以不能从个别的列取回数据）;

    * `GROUP BY` 子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在SELECT中使用表达式，则必须在 `GROUP BY` 子句中指定相同的表达式。不能使用别名;

    * 除聚集计算语句外，SELECT语句中的每个列都 *必须* 在 `GROUP BY` 子句中给出;

    * 如果分组列中具有NULL值，则NULL将作为一个分组返回。如果列中有多行NULL值，它们将分为一组;

    * `GROUP BY` 子句 *必须* 出现在WHERE子句之后，ORDER BY子句之前

* `... GROUP BY `value` WITH ROLLUP;`
    * 使用WITH ROLLUP关键字，可以得到每个分组以及每个分组汇总级别（针对每个分组）的值 (TODO:然而我并没有看啥门道)

### 13.3 过滤分组 .............................85

* 除了能用 GROUP BY 分组数据外，MySQL还允许过滤分组，规定包括哪些分组，排除哪些分组

* HAVING 非常类似于 WHERE
    * 事实上，目前为止所学过的所有类型的 WHERE 子句都可以用 HAVING 来替代。唯一的差别是 WHERE 过滤行，而 HAVING 过滤分组

* HAVING 支持所有 WHERE 操作符

* **区别**: HAVING 是对查询结果进行过滤, 而 WHERE 是过滤后才查询出来
```
# WHERE: 使用主键, 只扫描一条记录
EXPLAIN SELECT * FROM oa_dicts WHERE id=1;

# HAVING: 没有使用任何索引, 扫面全表
EXPLAIN SELECT * FROM oa_dicts HAVING id=1;
```

* 所以 having 的性能是很差的啊

### 13.4 分组和排序 .........................87
* ORDER BY 与 GROUP BY:
```
ORDER BY                                     GROUP BY
排序产生的输出                                分组行。但输出可能不是分组的顺序
任意列都可以使用（甚至非选择的列也可以使用）    只可能使用选择列或表达式列，而且必须使用每个选择列表达式
不一定需要                                   如果与聚集函数一起使用列（或表达式），则必须使用
```

* **不要忘记ORDER BY**
    * 一般在使用 `GROUP BY` 子句时，应该也给出 `ORDER BY`子句。这是 *保证数据正确排序的唯一方法*。 **千万不要** 仅依赖 `GROUP BY` 排序数据

### 13.5 SELECT子句顺序.................88
* SELECT子句及其顺序
```
子句              说明                              是否必须使用
SELECT            要返回的列或表达式                 是
FROM              从中检索数据的表                   仅在从表选择数据时使用
WHERE             行级过滤                          否
GROUP BY          分组说明                          仅在按组计算聚集时使用
HAVING            组级过滤                          否
ORDER BY          输出排序顺序                      否
LIMIT             要检索的行数                      否
```

### 13.6 小结.....................................89
