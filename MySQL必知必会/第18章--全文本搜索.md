## 目录
```
### 第18章 全文本搜索................. 119
#### 18.1 理解全文本搜索............... 119
#### 18.2 使用全文本搜索............... 120
* 18.2.1 启用全文本搜索支持.................... 120
* 18.2.2 进行全文本搜索.................... 121
* 18.2.3 使用查询扩展.... 124
* 18.2.4 布尔文本搜索.... 126
* 18.2.5 全文本搜索的使用说明............ 129
#### 18.3 小结................................... 130
```



## 第18章 全文本搜索................. 119
### 18.1 理解全文本搜索............... 119
* 并非所有引擎都支持全文本搜索:
    * MyISAM 支持全文本搜索
    * InnoDB 不支持

* 使用全文本搜索时，MySQL 不需要分别查看每个行，不需要分别分析和处理每个词。MySQL 创建指定列中各词的一个索引，搜索可以针对这些词进行。这样，MySQL 可以快速有效地决定哪些词匹配（哪些行包含它们），哪些词不匹配，它们匹配的频率，等等。    

### 18.2 使用全文本搜索............... 120
* 在索引之后，SELECT 可与 Match() 和 Against() 一起使用以实际执行搜索

#### 18.2.1 启用全文本搜索支持.................... 120
* 为字段创建全文索引: CREATE TABLE 语句（第21章中介绍）接受 **`FULLTEXT`** 子句，它给出被索引列的一个逗号分隔的列表

* 在定义之后，MySQL自动维护该索引。在增加、更新或删除行时，索引随之自动更新

* **不要在导入数据时使用FULLTEXT**
> 更新索引要花时间，虽然不是很多，但毕竟要花时间。*如果正在导入数据到一个新表，此时不应该启用FULLTEXT索引*。应该首先导入所有数据，然后再修改表，定义FULLTEXT。这样有助于更快地导入数据（而且使索引数据的总时间小于在导入每行时分别进行索引所需的总时间）。

* 先导入数据, 再建立全文索引

#### 18.2.2 进行全文本搜索.................... 121
* 在索引之后，使用两个函数 `Match()` 和 `Against()` 执行全文本搜索
    * `Match()` 指定被搜索的列 (索引的字段名)
    * `Against()` 指定要使用的搜索表达式 (搜索的内容)

* **使用完整的 Match() 说明**
    * 传递给 `Match()` 的值必须与 `FULLTEXT()` 定义中的相同。如果指定多个列，则必须列出它们（而且次序正确）

* 搜索不区分大小写

* eg:
```mysql
SELECT note_text
FROM productnotes
WHERE Match(note_text) Against('rabbit');
```

* 事实是刚才的搜索可以简单地用 LIKE 子句完成:
```mysql
SELECT note_text
FROM productnotes
WHERE note_text LIKE '%rabbit%';
```

* 全文本搜索的一个重要部分就是对结果排序。具有较高等级的行先返回（因为这些行很可能是你真正想要的行）。
```mysql
SELECT  note_text, 
        Match(note_text) Against('rabbit') AS rank 
FROM productnotes

* 此列包含全文本搜索计算出的等级值。等级由MySQL根据行中词的数目、唯一词的数目、整个索引中词的总数以及包含该词的行的数目计算出来

* 全文本搜索提供了简单LIKE搜索不能提供的功能 (就是这个 rank 值)。而且，由于数据是索引的，全文本搜索还相当快 
```

#### 18.2.3 使用查询扩展.... 124
* **查询扩展** 用来设法放宽所返回的全文本搜索结果的范围
    * 考虑下面的情况。你想找出所有提到 anvils 的注释。只有一个注释包含词 anvils ，但你还想找出可能与你的搜索有关的所有其他行(TODO: mysql 怎么知道)，即使它们不包含词 anvils 。

* 在使用查询扩展时，MySQL对数据和索引进行两遍扫描来完成搜索：
    * 首先，进行一个基本的全文本搜索，找出与搜索条件匹配的所有行；
    * 其次，MySQL检查这些匹配行并选择所有有用的词（*我们将会简要地解释MySQL如何断定什么有用，什么无用*）;
    * 再其次，MySQL再次进行全文本搜索，这次不仅使用原来的条件，而且还使用所有有用的词。


* 使用查询扩展:
```
SELECT  note_text, 
        FROM productnotes
WHERE Match(note_text) Against('anvils' WITH QUERY EXPANSION)
```

* TODO: 表示没有看懂

#### 18.2.4 布尔文本搜索.... 126
* MySQL 支持全文本搜索的另外一种形式，称为布尔方式（boolean mode）

* 即使没有 FULLTEXT 索引也可以使用 
    * 布尔方式不同于迄今为止使用的全文本搜索语法的地方在于，即使没有定义 FULLTEXT 索引，也可以使用它。但这是一种非常缓慢的操作（其性能将随着数据量的增加而降低）。

* `IN BOOLEAN MODE`
```mysql
SELECT  note_text, 
        FROM productnotes
WHERE Match(note_text) Against('anvils' IN BOOLEAN MODE);
```

* eg:
```
SELECT * FROM oa_dicts 
WHERE 
MATCH(display_name) AGAINST('高中*' IN BOOLEAN MODE);
```

* **全文本布尔操作符**
```
布尔操作符   说明
+           包含，词必须存在
-           排除，词必须不出现
>           包含，而且增加等级值
<           包含，且减少等级值
()          把词组成子表达式（允许这些子表达式作为一个组被包含、排除、排列等）
~           取消一个词的排序值
*           词尾的通配符
""          定义一个短语（与单个词的列表不一样，它匹配整个短语以便包含或排除这个短语）
```

* TODO: 有啥用...  


#### 18.2.5 全文本搜索的使用说明............ 129


### 18.3 小结................................... 130


* TODO: 这块知识太旧了, mysql 5.7 已经支持 InnoDB 引擎的中文全文索引.