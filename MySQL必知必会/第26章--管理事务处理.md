## 目录
```
### 第26章 管理事务处理.............187
#### 26.1 事务处理 ...........................187
#### 26.2 控制事务处理 ...................189
* 26.2.1 使用ROLLBACK.....189
* 26.2.2 使用COMMIT........190
* 26.2.3 使用保留点 ........191
* 26.2.4 更改默认的提交行为....................192
#### 26.3 小结...................................192
```


## 第26章 管理事务处理.............187
* 利用 `COMMIT` 和 `ROLLBACK` 语句来管理事务处理

### 26.1 事务处理 ...........................187
* 只有 `InnoDB` 数据库引擎才支持事务处理

* **事务处理（transaction processing）** 可以用来维护数据库的完整性，*它保证成批的 MySQL 操作要么完全执行，要么完全不执行*

* 关于事务的 几个术语:
    * **事务（transaction）** 指一组SQL语句;
    * **回退（rollback）** 指撤销指定SQL语句的过程;
    * **提交（commit）** 指将未存储的SQL语句结果写入数据库表;
    * **保留点（savepoint）** 指事务处理中设置的临时占位符（placeholder），你可以对它发布回退（与回退整个事务处理不同）.

### 26.2 控制事务处理 ...................189
* MySQL使用下面的语句来标识事务的开始： `START TRANSACTION`

#### 26.2.1 使用ROLLBACK.....189
* MySQL 的 `ROLLBACK` 命令用来回退（撤销）MySQL 语句

* eg:
```mysql
SELECT * FROM ordertotals;
START TRANSACTION;
    DELETE FROM ordertotals
    SELECT * FROM ordertotals;
ROLLBACK;
SELECT * FROM ordertotals
```

* **哪些语句可以回退？**:
    * 事务处理用来管理 INSERT、UPDATE 和 DELETE 语句;
    * 你不能回退 SELECT 语句。（这样做也没有什么意义。）;
    * 你 **不能** 回退 CREATE 或 DROP 操作:
        * 事务处理块中可以使用这两条语句，但如果你执行回退，它们不会被撤销.

#### 26.2.2 使用COMMIT........190
* 一般的 MySQL 语句都是直接针对数据库表执行和编写的。这就是所谓的 **隐含提交（implicit commit）**，即提交（写或保存）操作是 *自动进行* 的

* eg:
```mysql
START TRANSACTION;
    DELETE FROM orderitems WHERE order_num = 2000;
    DELETE FROM orders WHERE order_num = 2000;
COMMIT;
```

* **隐含事务关闭** 当 COMMIT 或 ROLLBACK 语句执行后，事务会自动关闭（将来的更改会隐含提交）

#### 26.2.3 使用保留点 ........191
* 简单的 ROLLBACK 和 COMMIT 语句就可以写入或撤销整个事务处理。
    * 但是，只是对简单的事务处理才能这样做，更复杂的事务处理可能需要 *部分提交或回退*

* 为了支持回退部分事务处理，必须能在事务处理块中合适的位置放置占位符。这样，如果需要回退，可以回退到某个占位符。

* 这些占位符称为保留点。为了创建占位符，可如下使用 `SAVEPOINT` 语句：
    * `SAVEPOINT delete1`

* 回滚到某个保留点: `ROLLBACK TO delete1`

* **保留点越多越好**
    * 可以在MySQL代码中设置任意多的保留点，越多越好。为什么呢？因为保留点越多，你就越能按自己的意愿灵活地进行回退。

* **释放保留点** 
    * 保留点在事务处理完成（执行一条 ROLLBACK 或 COMMIT）后自动释放。自MySQL 5以来，也可以用 `RELEASE SAVEPOINT` 明确地释放保留点

#### 26.2.4 更改默认的提交行为....................192
* 默认的MySQL行为是自动提交所有更改
    * 换句话说, 任何时候你执行一条MySQL语句，该语句实际上都是针对表执行的，而且所做的更改立即生效

* 为指示MySQL不自动提交更改，需要使用以下语句
    * `SET autocommit=0;`

    * autocommit 标志决定是否自动提交更改，不管有没有 COMMIT 语句。设置 autocommit 为0（假）指示 MySQL 不自动提交更改（*直到 autocommit 被设置为真为止*）

    * **标志为连接专用** autocommit 标志 *是针对每个连接* 而不是服务器的

### 26.3 小结...................................192
